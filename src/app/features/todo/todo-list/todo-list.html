<div class="max-w-4xl mx-auto p-4">
    <!-- Header -->
    <div class="flex items-center justify-between">
        <h1 class="text-4xl font-bold text-foreground">Todo List {{TodoService.total()}}</h1>
        <button z-button type="button" routerLink="/todo/new" [attr.aria-label]="'Add new todo'" class="px-6 py-3">
            <z-icon zType="plus" zSize="sm" class="mr-2"></z-icon>
            Add New Task
        </button>
    </div>
    <div class="my-6 relative">
        <div class="absolute inset-y-0 left-0 flex items-center pl-4 pointer-events-none">
            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
            </svg>
        </div>
        <input z-input type="text" placeholder="Search todos by description or category..." class="w-full pl-11"
            [value]="searchQuery()" (input)="searchQuery.set($any($event.target).value)" />
    </div>
    <!-- Tabs -->
    <div class="flex gap-2 mb-6 p-2 bg-card rounded-lg border border-border">
        <button z-button type="button" class="flex-1" [zType]="selectedStatus() === 'all' ? 'default' : 'ghost'"
            (click)="selectedStatus.set('all')">All</button>
        <button z-button type="button" class="flex-1" [zType]="selectedStatus() === 'active' ? 'default' : 'ghost'"
            (click)="selectedStatus.set('active')">Active</button>
        <button z-button type="button" class="flex-1" [zType]="selectedStatus() === 'completed' ? 'default' : 'ghost'"
            (click)="selectedStatus.set('completed')">Completed</button>
    </div>
    <!-- Bulk Selection Bar -->
    @if(todoselected().size > 0) {
    <div
        class="flex flex-wrap items-center gap-2 mb-4 p-3 bg-primary/5 border border-primary/20 rounded-2xl animate-in fade-in slide-in-from-top-4 duration-300">
        <span class="text-sm font-bold text-primary ml-2">{{ selectionCountText() }}</span>

        <div class="h-4 w-px bg-primary/20 mx-2"></div>

        <button z-button zType="ghost" zSize="sm" class="text-green-600 hover:text-green-700 hover:bg-green-50"
            (click)="bulkComplete()">
            <z-icon [zType]="getIcon('circle-check')" zSize="sm" class="mr-1.5"></z-icon>
            Complete All
        </button>

        <button z-button zType="ghost" zSize="sm"
            class="text-destructive hover:text-destructive hover:bg-destructive/10" (click)="bulkdelete()">
            <z-icon [zType]="getIcon('trash')" zSize="sm" class="mr-1.5"></z-icon>
            Delete
        </button>

        <button z-button zType="ghost" zSize="sm" (click)="cancelSelection()">
            <z-icon [zType]="getIcon('x')" zSize="sm" class="mr-1.5"></z-icon>
            Cancel
        </button>
    </div>
    }

    <!--categories-->
    <div class="flex flex-wrap items-center gap-2 mb-2">
        <button z-button [zType]="selectedCategory() === null ? 'default' : 'outline'"
            (click)="selectedCategory.set(null)">All Categories</button>
        @for (cat of predefinedCategories(); track cat) {
        <button z-button [zType]="selectedCategory() === cat ? 'default' : 'outline'" class="flex items-center gap-2"
            (click)="selectedCategory.set(cat)">
            <z-icon [zType]="getIcon(predefinedcategory[cat].icon)" zSize="sm"></z-icon>
            {{cat}}
        </button>
        }
    </div>
</div>

<!-- Todo items list With Drag& Drop -->
<div class="mt-4">
    @if(filteredTodos().length > 0) {
    <div class="flex items-center gap-4 px-5 mb-4 group/select-all">
        <div class=" flex items-center justify-center w-5 h-5 xl:ml-78 ">
            <input type="checkbox" [checked]="isAllSelected()" (change)="toggleSelectAll($any($event.target).checked)"
                class="appearance-none w-5 h-5 cursor-pointer  rounded-md border-2 border-primary/20 checked:bg-primary checked:border-primary transition-all duration-200 cursor-pointer hover:border-primary/40 focus:ring-2 focus:ring-primary/20 focus:outline-none">
            <svg class="absolute w-3 h-3 text-white pointer-events-none opacity-0 scale-50 transition-all duration-200"
                [class.opacity-100]="isAllSelected()" [class.scale-100]="isAllSelected()" fill="none"
                stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7" />
            </svg>
        </div>
        <span
            class="text-xs font-bold text-muted-foreground/60 uppercase tracking-widest group-hover/select-all:text-primary transition-colors cursor-pointer"
            (click)="toggleSelectAll(!isAllSelected())">
            Select All Tasks
        </span>
    </div>

    @for (todo of filteredTodos(); track todo.id) {
    <div cdkDrag class="mb-4">
        <app-todo-item [todo]="todo" [isSelected]="todoselected().has(todo.id)" (remove)="onRemove($event)"
            (selectToggle)="onItemSelect(todo.id, $event)">
        </app-todo-item>
    </div>
    }
    } @else {
    <div class="text-center py-12 bg-card/40 backdrop-blur-sm border border-ghost/40 rounded-3xl">
        <div class="w-16 h-16 bg-muted/30 rounded-full flex items-center justify-center mx-auto mb-4">
            <z-icon zType="clipboard" zSize="lg" class="text-muted-foreground/40"></z-icon>
        </div>
        <p class="text-muted-foreground font-medium">No tasks found matching your filters. Try adjusting them!</p>
    </div>
    }
</div>